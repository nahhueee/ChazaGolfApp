<div class="contenido">
    <div class="encabezado">
        <div class="info">
            <h3>{{cliente}}</h3>
           |
           <h3>Deuda total <span class="deuda">${{totalDeuda | decimalFormat}}</span></h3>
           |
           <div class="btns">
            <p-button label="Entrega de Dinero" icon="pi pi-dollar" severity="primary" (onClick)="Entrega()" />
            <p-button label="Historial Entregas" icon="pi pi-history" severity="primary" disabled="true" />
           </div>
           
        </div>


        <form [formGroup]="filtros" class="filtros"> 
            <div class="izq">
                <div class="seleccionable">
                    <div class="item-seleccionable">
                        <p-radioButton
                            name="estadoPago"
                            inputId="impagas"
                            formControlName="impagas"
                            [value]="1"
                        />
                        <label for="impagas">Solo ventas impagas</label>
                    </div>

                    <div class="item-seleccionable">
                        <p-radioButton
                            name="estadoPago"
                            inputId="todas"
                            formControlName="impagas"
                            [value]="0"
                        />
                        <label for="todas">Todas las ventas</label>
                    </div>
                </div>


                <p-floatlabel variant="on">
                    <p-select [options]="procesos" formControlName="proceso" optionLabel="descripcion"/>
                    <label>Proceso</label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <p-datepicker formControlName="fechas" selectionMode="range"/>
                    <label>Rango de Fecha</label>
                </p-floatlabel>
            </div>
            <div class="der">
                <p-button label="Buscar" severity="primary" icon="pi pi-search" (onClick)="Buscar()"/>
                <p-button label="Limpiar" severity="secondary" icon="pi pi-filter-slash" (onClick)="LimpiarFiltros()" />
            </div>
            
        </form> 
    </div>

    <div class="tabla">
        <p-table 
        [value]="ventas"
        [lazy]="true"
        [paginator]="true"
        [rows]="10"
        [totalRecords]="totalRecords"
        (onLazyLoad)="Buscar($event)"
        [loading]="loading"
        [rowsPerPageOptions]="[10,20,50]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords}"
        [tableStyle]="{ 'min-width': '60rem' }">
        
            <ng-template #header>
                <tr>
                    <th>Proceso</th>
                    <th>Nro</th>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Total</th>
                    <th>Entregado</th>
                    <th>Deuda</th>
                    <th>Acciones</th>
                </tr>
            </ng-template>
            <ng-template #body let-venta>
                <tr>
                    <td>{{ venta.proceso }}</td>
                    <td>{{ venta.nroProceso }}</td>
                    <td>{{ venta.fecha | date:'dd-MM-yyyy' }}</td>
                    <td>{{ venta.hora }}</td>
                    <td>${{ venta.total | decimalFormat }}</td>
                    <td>${{ venta.entregado | decimalFormat}}</td>
                    <td>${{ venta.deuda | decimalFormat}}</td>

                    <td>
                        <div class="acciones">
                            <p-button severity="primary" styleClass="p-button-sm" [rounded]="true" [outlined]="true" icon="pi pi-eye" (onClick)="ventaSeleccionada = venta; detalleVisible = true" pTooltip="Ver Resumen" tooltipPosition="bottom"/>
                            @if(venta.impaga == 1){
                                <p-button severity="success" styleClass="p-button-sm" [rounded]="true" [outlined]="true" icon="pi pi-dollar" (onClick)="EntregaVenta(venta)" pTooltip="Saldar Deuda" tooltipPosition="bottom"/>
                            }
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

</div>

<div class="botones">
    <p-button label="Volver" severity="secondary" (click)="Cerrar()" icon="pi pi-angle-left"/>
</div>


<app-vista-previa [(visible)]="detalleVisible" [venta]="ventaSeleccionada"></app-vista-previa>
<app-entrega-dinero  [(visible)]="entregaVisible" [venta]="ventaSeleccionada" [desdeVenta]="desdeVenta" [idCliente]="idCliente" [deudaTotal]="totalDeuda" (recargar)="onRecargar($event)"></app-entrega-dinero>

